<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Chatbot</title>
      <style>
         #chatbot-container {
         position: fixed;
         bottom: 20px;
         left: 20px;
         width: 300px;
         background-color: #fff;
         border: 2px solid #ccc;
         border-radius: 10px;
         box-shadow: 0 4px 8px rgba(227, 221, 221, 0.1);
         font-family: Arial, sans-serif;
         }
         #chatbot-header {
         background-color: #007bff;
         color: white;
         padding: 10px;
         border-top-left-radius: 10px;
         border-top-right-radius: 10px;
         cursor: pointer;
         text-align: center;
         }
         #chatbot-content {
         padding: 10px;
         display: none;
         }
         #chatbot-messages {
         height: 200px;
         overflow-y: auto;
         border-bottom: 1px solid #ddd;
         margin-bottom: 10px;
         }
         #chatbot-input {
         width: calc(100% - 60px);
         padding: 10px;
         border: 1px solid #ddd;
         border-radius: 5px;
         }
         #send-button {
         padding: 10px;
         background-color: #007bff;
         color: white;
         border: none;
         border-radius: 5px;
         cursor: pointer;
         }
         #send-button:hover {
         background-color: #0056b3;
         }
      </style>
   </head>
   <body>
      <div id="chatbot-container">
         <div id="chatbot-header">Chatea con nosotros!</div>
         <div id="chatbot-content">
            <div id="chatbot-messages"></div>
            <input type="text" id="chatbot-input" placeholder="Escribe un mensaje..." />
            <button id="send-button">Enviar</button>
         </div>
      </div>
      <script>
         // Toggle chatbot visibility when header is clicked
         document.getElementById('chatbot-header').onclick = function () {
            const content = document.getElementById('chatbot-content');
            if (content.style.display === 'none' || content.style.display === '') {
               content.style.display = 'block';
            } else {
               content.style.display = 'none';
            }
         };
         
         // Function to append messages to chat
         function appendMessage(content, sender = 'user') {
            const messageElement = document.createElement('div');
            messageElement.textContent = sender === 'user' ? `You: ${content}` : `Bot: ${content}`;
            document.getElementById('chatbot-messages').appendChild(messageElement);
         }
         
         // Send message functionality
         document.getElementById('send-button').onclick = async function () {
            const inputField = document.getElementById('chatbot-input');
            const message = inputField.value.trim();
         
            if (message) {
               // Append the user's message to the chat
               appendMessage(message, 'user');
         
               // Clear input field
               inputField.value = '';
         
               // Send the message to the backend
               try {
                  const response = await fetch('http://127.0.0.1:8000/predict', {
                     method: 'POST',
                     headers: {
                        'Content-Type': 'application/json',
                     },
                     body: JSON.stringify({study_and_condition: message}),
                  });
                  
                  const data = await response.json();
                  
                  // Append the bot's response to the chat
                  appendMessage(data, 'bot');
               } catch (error) {
                  console.error('Error:', error);
                  appendMessage('Error: Failed to contact server', 'bot');
               }
            }
         };
      </script>
   </body>
</html>